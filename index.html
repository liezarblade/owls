<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TO·ó∞·ó©TO</title>

  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="dose.css">
</head>

<body>

<header>
  <div class="logo">üçÖ T O ·ó∞ ·ó© T O </div>

  <div class="controls">
      <select id="sortSelect">
          <option value="az">Sort A ‚Üí Z</option>
          <option value="za">Sort Z ‚Üí A</option>
      </select>

      <select id="gridSelect">
          <option value="auto">Layout</option>
          <option value="1">1 per row</option>
          <option value="2">2 per row</option>
          <option value="3">3 per row</option>
          <option value="4">4 per row</option>
      </select>

      <button id="toggleMode" class="toggle-btn">THEME</button>

      <button id="listViewBtn" class="toggle-btn" style="display:none;">onlyFans</button>
      <button id="doseBtn" class="toggle-btn">Ullu Originals</button>
  </div>
</header>


<div class="search-container">
  <input type="text" id="searchInput" placeholder=" Search by name‚Ä¶">
</div>

<div id="topPicksSection"></div>
<div id="latestHitsSection"></div>

<div id="gallery" class="gallery"></div>
<div id="pagination"></div>

<button class="scroll-to-top" id="scrollTopBtn">‚ñ≤</button>

<!-- DOSE GRID -->
<div id="doseContainer" class="gallery" style="display:none; padding-top:10px;"></div>

<!-- DOSE POPUP -->
<div id="dosePopup" aria-hidden="true">
  <div id="doseBox">
    <div id="doseLeft">
      <img id="popupImage" src="" alt="">
    </div>

    <div id="doseRight">
      <div id="doseHeader">
        <div>
          <div id="doseName"></div>
          <div id="doseSub" style="color:#aaa; font-size:13px;">Prefer V-Cloud</div>
        </div>

        <button id="doseCloseBtn">‚úï</button>
      </div>

      <div id="doseBody" style="margin-top:8px; overflow:auto; max-height:60vh;"></div>
    </div>
  </div>
</div>

<script>

const ITEMS_PER_PAGE = 100;
let fullData = [], filteredData = [], currentPage = 1;

let doseData = [];
let doseFiltered = [];
let inDoseMode = false;

/* ======================================================
   AUTO GRID
====================================================== */
function autoGrid() {
    if (window.innerWidth < 600) return "1";
    if (window.innerWidth < 900) return "2";
    return "3";
}

function applyGridSetting(value) {
    const g1 = document.getElementById("gallery");
    const g2 = document.getElementById("doseContainer");

    const cols = value === "auto" ? autoGrid() : value;

    g1.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
    g2.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
}

document.getElementById("gridSelect").addEventListener("change", e => {
    applyGridSetting(e.target.value);
});

/* ======================================================
   LOAD MAIN DASHBOARD
====================================================== */
async function loadData() {
    try {
        const response = await fetch("data.json");
        fullData = await response.json();
    } catch (e) {
        fullData = [];
    }

    filteredData = [...fullData];

    applyGridSetting("auto");
    renderCategories();
    renderPage(1);

    document.getElementById("doseBtn").style.display = "inline-block";
    document.getElementById("listViewBtn").style.display = "none";
}

/* ======================================================
   CATEGORIES
====================================================== */
function renderCategories() {
    const top = fullData.filter(x => x.category === "Top Picks");
    const latest = fullData.filter(x => x.category === "Latest Hits");

    const t = document.getElementById("topPicksSection");
    const l = document.getElementById("latestHitsSection");

    t.innerHTML = ""; l.innerHTML = "";

    if (top.length) {
        t.innerHTML = `<h2 style="margin-top:20px;">üî• Top Picks</h2>`;
        t.appendChild(makeCategoryGrid(top));
    }

    if (latest.length) {
        l.innerHTML = `<h2 style="margin-top:20px;">‚ú® Latest Hits</h2>`;
        l.appendChild(makeCategoryGrid(latest));
    }
}

function makeCategoryGrid(list) {
    const sec = document.createElement("div");
    sec.style.display = "grid";
    sec.style.gridTemplateColumns = `repeat(${autoGrid()}, 1fr)`;
    sec.style.gap = "15px";

    list.forEach(item => {
        const c = document.createElement("div");
        c.className = "card";
        c.innerHTML = `
        <a href="${item.link}" target="_blank">
            <img loading="lazy" src="${item.image}">
            <div class="card-title">${item.name}</div>
        </a>`;
        sec.appendChild(c);
    });

    return sec;
}

/* ======================================================
   SORT (MAIN + DOSE)
====================================================== */
function sortData(type) {
    if (!inDoseMode) {
        filteredData.sort((a, b) => {
            return type === "az"
                ? a.name.localeCompare(b.name)
                : b.name.localeCompare(a.name);
        });
        renderPage(1);
    } else {
        doseFiltered.sort((a, b) => {
            return type === "az"
                ? a.name.localeCompare(b.name)
                : b.name.localeCompare(a.name);
        });
        renderDoseGrid();
    }
}

document.getElementById("sortSelect").addEventListener("change", e => {
    sortData(e.target.value);
});

/* ======================================================
   SEARCH (ALREADY UNIVERSAL ‚Äî DO NOT CHANGE)
====================================================== */
document.getElementById("searchInput").addEventListener("input", e => {
    const q = e.target.value.toLowerCase();

    if (!inDoseMode) {
        filteredData = fullData.filter(x => x.name.toLowerCase().includes(q));
        renderPage(1);
    } else {
        doseFiltered = doseData.filter(x => x.name.toLowerCase().includes(q));
        renderDoseGrid();
    }
});

/* ======================================================
   MAIN PAGE RENDER
====================================================== */
function renderPage(num) {
    currentPage = num;

    const gal = document.getElementById("gallery");
    gal.innerHTML = "";

    const start = (num - 1) * ITEMS_PER_PAGE;
    const end = start + ITEMS_PER_PAGE;

    filteredData.slice(start, end).forEach(item => {
        if (item.category === "Top Picks" || item.category === "Latest Hits") return;

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <a href="${item.link}" target="_blank">
                <img loading="lazy" src="${item.image}">
                <div class="card-title">${item.name}</div>
            </a>`;
        gal.appendChild(card);
    });

    renderPagination();
}

function renderPagination() {
    const p = document.getElementById("pagination");
    const total = Math.max(1, Math.ceil(filteredData.length / ITEMS_PER_PAGE));

    p.innerHTML = `
        ${currentPage > 1 ? `<button onclick="renderPage(${currentPage - 1})">Prev</button>` : ""}
        <span>Page ${currentPage} / ${total}</span>
        ${currentPage < total ? `<button onclick="renderPage(${currentPage + 1})">Next</button>` : ""}
    `;
}

/* ======================================================
   DOSE DASHBOARD
====================================================== */
document.getElementById("doseBtn").addEventListener("click", openDoseDashboard);
document.getElementById("listViewBtn").addEventListener("click", closeDoseDashboard);

async function openDoseDashboard() {

    inDoseMode = true;

    try {
        const res = await fetch("dose.json");
        doseData = await res.json();
    } catch {
        doseData = [];
    }

    doseFiltered = [...doseData];

    document.getElementById("topPicksSection").style.display = "none";
    document.getElementById("latestHitsSection").style.display = "none";
    document.getElementById("gallery").style.display = "none";
    document.getElementById("pagination").style.display = "none";

    document.getElementById("doseContainer").style.display = "grid";

    document.getElementById("doseBtn").style.display = "none";
    document.getElementById("listViewBtn").style.display = "inline-block";

    renderDoseGrid();
}

/* DOSE GRID RENDER */
function renderDoseGrid() {
    const box = document.getElementById("doseContainer");
    box.innerHTML = "";

    doseFiltered.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <img src="${item.image}">
            <div class="card-title">${item.name}</div>
        `;
        card.onclick = () => openDosePopup(item);
        box.appendChild(card);
    });
}

/* EXIT DOSE MODE */
function closeDoseDashboard() {
    inDoseMode = false;

    document.getElementById("doseContainer").style.display = "none";

    document.getElementById("topPicksSection").style.display = "block";
    document.getElementById("latestHitsSection").style.display = "block";
    document.getElementById("gallery").style.display = "grid";
    document.getElementById("pagination").style.display = "block";

    document.getElementById("doseBtn").style.display = "inline-block";
    document.getElementById("listViewBtn").style.display = "none";

    renderPage(1);
}

/* ======================================================
   DOSE POPUP
====================================================== */
function openDosePopup(item) {
    document.getElementById("popupImage").src = item.image;
    document.getElementById("doseName").textContent = item.name;

    const body = document.getElementById("doseBody");
    body.innerHTML = "";

    item.qualities.forEach(q => {
        body.innerHTML += `
            <div class="qualityBlock">
                <div class="qualityTitle">${q.quality}</div>
                <div class="clientButtons">
                    ${q.clients.map(c => `<a href="${c.link}" target="_blank">${c.name}</a>`).join("")}
                </div>
            </div>`;
    });

    document.getElementById("dosePopup").style.display = "flex";
}

document.getElementById("doseCloseBtn").addEventListener("click", () => {
    document.getElementById("dosePopup").style.display = "none";
});


/* ======================================================
   GLOBAL THEME SWITCH (LIGHT/DARK)
====================================================== */
document.getElementById("toggleMode").addEventListener("click", () => {
    document.body.classList.toggle("dark");

    const pop = document.getElementById("dosePopup");
    pop.classList.toggle("dark");

    const box = document.getElementById("doseBox");
    box.classList.toggle("dark");
});


/* INITIAL LOAD */
loadData();

</script>
</body>
</html>
